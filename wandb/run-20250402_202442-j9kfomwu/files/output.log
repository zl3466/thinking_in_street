  0%|                                                                                                                                                                                                          | 0/231 [00:00<?, ?it/s]Traceback (most recent call last):

full prompt: [[{'content': [{'text': None, 'type': 'video', 'video': ['/scratch/zl3466/dataset/NuScenes/train/samples/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400233612460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400234012460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400234412460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400234862460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400235262460.jpg', '/scratch/zl3466/dataset/NuScenes/train/samples/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400235662460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400236112460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400236512460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400236912460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400237362460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400237862460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400238262460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400238762460.jpg', '/scratch/zl3466/dataset/NuScenes/train/samples/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400239162460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400239612460.jpg']}, {'text': "I uploaded 16 frames from a vehicle dash cam video. \nDetermine the vehicle's change in heading direction between each frame and its previous frame.\nGive your answer in degree values ranging between -180 and 180 degrees, with right turn being positive degrees and left turn being negative degrees.\nKeep all degree values in one list. You should have 15 values in the list.\n\nPlease think about this question as if you were a human pondering deeply. Engage in an internal dialogue using expressions such as 'let me think', 'wait', 'Hmm', 'oh, I see', 'let's break it down', etc, or other natural language thought expressions It's encouraged to include self-reflection or verification in the reasoning process. Provide your detailed reasoning between the <think> </think> tags, and then give your final answer between the <answer> </answer> tags. Please provide the list answer (e.g., [val, val, val, ...]) within the <answer> </answer> tags.", 'type': 'text', 'video': None}], 'role': 'user'}]]

full prompt_text: ['<|im_start|>system\nYou are a helpful assistant.<|im_end|>\n<|im_start|>user\n<|vision_start|><|video_pad|><|vision_end|><|vision_start|><|video_pad|><|vision_end|><|im_end|>\n<|im_start|>assistant\n']
num of texts 1

full input: [{'problem_id': 2, 'problem': "I uploaded 16 frames from a vehicle dash cam video. \nDetermine the vehicle's change in heading direction between each frame and its previous frame.\nGive your answer in degree values ranging between -180 and 180 degrees, with right turn being positive degrees and left turn being negative degrees.\nKeep all degree values in one list. You should have 15 values in the list.\n", 'data_type': 'video', 'problem_type': 'list', 'options': [], 'solution': '<answer>[0.011657387526621675, 0.11074548753034798, 0.2223331862020149, 0.22167258035547335, 0.08866933361995638, 0.029168179522764355, -0.033538796801753104, -0.19684225467201358, 0.26189990071791047, 0.03908701622768359, 0.15707626884443066, -0.03591922767815197, 0.02146065519456543, -0.2029756991145171, -0.11221017060146811]</answer>', 'path': ['/scratch/zl3466/dataset/NuScenes/train/samples/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400233612460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400234012460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400234412460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400234862460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400235262460.jpg', '/scratch/zl3466/dataset/NuScenes/train/samples/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400235662460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400236112460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400236512460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400236912460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400237362460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400237862460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400238262460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400238762460.jpg', '/scratch/zl3466/dataset/NuScenes/train/samples/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400239162460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400239612460.jpg'], 'reward': 1, 'select': True, 'prompt': [{'content': [{'text': None, 'type': 'video', 'video': ['/scratch/zl3466/dataset/NuScenes/train/samples/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400233612460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400234012460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400234412460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400234862460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400235262460.jpg', '/scratch/zl3466/dataset/NuScenes/train/samples/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400235662460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400236112460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400236512460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400236912460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__1532400237362460.jpg', '/scratch/zl3466/dataset/NuScenes/train/sweeps/CAM_FRONT/n015-2018-07-24-10-42-41+0800__CAM_FRONT__
video inputs in processor:  {'pixel_values_videos': tensor([[ 0.0617,  0.1201, -0.0405,  ...,  0.1124,  0.1124,  0.1409],
        [ 0.2661,  0.2953,  0.3099,  ..., -0.0298, -0.4706, -0.7266],
        [ 0.4267,  0.3975,  0.2661,  ..., -0.0156, -0.0440,  0.0271],
        ...,
        [-1.0039, -1.0039, -0.9748,  ..., -0.7123, -0.6981, -0.7123],
        [-0.9748, -0.9456, -0.9456,  ..., -0.6128, -0.5986, -0.6412],
        [-1.0331, -1.0185, -0.9456,  ..., -0.7408, -0.7692, -0.7408]]), 'video_grid_thw': tensor([[ 8, 32, 60]])}
torch.Size([15360, 1176])
tensor([[ 8, 32, 60]])
['<|im_start|>system\nYou are a helpful assistant.<|im_end|>\n<|im_start|>user\n<|vision_start|><|video_pad|><|vision_end|><|vision_start|><|video_pad|><|vision_end|><|im_end|>\n<|im_start|>assistant\n']
  File "/scratch/zl3466/github/thinking_in_street/./train/localization/grpo.py", line 569, in <module>
    main(script_args, training_args, model_args)
  File "/scratch/zl3466/github/thinking_in_street/./train/localization/grpo.py", line 558, in main
    trainer.train()
  File "/scratch/zl3466/env/thinking-in-street/lib/python3.11/site-packages/transformers/trainer.py", line 2241, in train
    return inner_training_loop(
           ^^^^^^^^^^^^^^^^^^^^
  File "/scratch/zl3466/env/thinking-in-street/lib/python3.11/site-packages/transformers/trainer.py", line 2548, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs, num_items_in_batch)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/zl3466/env/thinking-in-street/lib/python3.11/site-packages/transformers/trainer.py", line 3698, in training_step
    loss = self.compute_loss(model, inputs, num_items_in_batch=num_items_in_batch)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/zl3466/github/thinking_in_street/train/localization/trainer/grpo_trainer.py", line 447, in compute_loss
    prompt_inputs = self.processing_class(
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "/scratch/zl3466/env/thinking-in-street/lib/python3.11/site-packages/transformers/models/qwen2_5_vl/processing_qwen2_5_vl.py", line 176, in __call__
    "<|placeholder|>" * (video_grid_thw[index].prod() // merge_length),
                         ~~~~~~~~~~~~~~^^^^^^^
IndexError: index 1 is out of bounds for dimension 0 with size 1
[rank0]: Traceback (most recent call last):
[rank0]:   File "/scratch/zl3466/github/thinking_in_street/./train/localization/grpo.py", line 569, in <module>
[rank0]:     main(script_args, training_args, model_args)
[rank0]:   File "/scratch/zl3466/github/thinking_in_street/./train/localization/grpo.py", line 558, in main
[rank0]:     trainer.train()
[rank0]:   File "/scratch/zl3466/env/thinking-in-street/lib/python3.11/site-packages/transformers/trainer.py", line 2241, in train
[rank0]:     return inner_training_loop(
[rank0]:            ^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/scratch/zl3466/env/thinking-in-street/lib/python3.11/site-packages/transformers/trainer.py", line 2548, in _inner_training_loop
[rank0]:     tr_loss_step = self.training_step(model, inputs, num_items_in_batch)
[rank0]:                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/scratch/zl3466/env/thinking-in-street/lib/python3.11/site-packages/transformers/trainer.py", line 3698, in training_step
[rank0]:     loss = self.compute_loss(model, inputs, num_items_in_batch=num_items_in_batch)
[rank0]:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/scratch/zl3466/github/thinking_in_street/train/localization/trainer/grpo_trainer.py", line 447, in compute_loss
[rank0]:     prompt_inputs = self.processing_class(
[rank0]:                     ^^^^^^^^^^^^^^^^^^^^^^
[rank0]:   File "/scratch/zl3466/env/thinking-in-street/lib/python3.11/site-packages/transformers/models/qwen2_5_vl/processing_qwen2_5_vl.py", line 176, in __call__
[rank0]:     "<|placeholder|>" * (video_grid_thw[index].prod() // merge_length),
[rank0]:                          ~~~~~~~~~~~~~~^^^^^^^
[rank0]: IndexError: index 1 is out of bounds for dimension 0 with size 1
